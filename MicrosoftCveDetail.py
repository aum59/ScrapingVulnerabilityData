import time
from selenium import webdriver
import pandas as pd

def get_microsoft_cve(cve):
    url = 'https://portal.msrc.microsoft.com/en-US/security-guidance/advisory/' + cve.upper()
    # /home/aum49/Documents/python3/ScrapingVulnerabilityData/chromedriver_win32/chromedriver
    # D:/aum/KKP/Python3 WorkShop/ScrapingVulnerabilityData/chromedriver_win32/chromedriver.exe
    driverpath = 'D:/aum/KKP/Python3 WorkShop/ScrapingVulnerabilityData/chromedriver_win32(ver83)/chromedriver.exe'
    driver = webdriver.Chrome(executable_path=driverpath)
    driver.get(url)
    time.sleep(3)
    print('Url :'+url)
# Title
    Title = driver.find_element_by_xpath('//*[@id="JelloWrapper"]/div[3]/div[2]/div/ui-view/div[2]/h2').text
    # print('CveNo : ' + Title[0:14])
    CveNo = Title[0:14]
    # print('CveName : ' + Title[16:])
    CveName = Title[16:]
    Description = ''
    for i in range(1, 5):
        try:
            Des = driver.find_element_by_xpath('//*[@id="JelloWrapper"]/div[3]/div[2]/div/ui-view/div[2]/div[1]/div[2]/p[' + str(i) + ']').text
            Description += Des
        except:
            break
    # print('CveDescription :' + Description)
    AttackScenario = ''
    for j in range(1, 4):
        try:
            Scenario = driver.find_element_by_xpath(
                '//*[@id="JelloWrapper"]/div[3]/div[2]/div/ui-view/div[2]/div[1]/div[2]/ul/li[' + str(j) + ']').text
            AttackScenario += Scenario
        except:
            break
    # print('AttackScenario :' + AttackScenario)
    Affected = []
    for k in range(1, 60):
        try:
            AffectProduct = driver.find_element_by_xpath('//*[@id="JelloWrapper"]/div[3]/div[2]/div/ui-view/div[2]/table[2]/tbody[' + str(k) + ']/tr[1]/td[1]').text
            AffectOS = driver.find_element_by_xpath('//*[@id="JelloWrapper"]/div[3]/div[2]/div/ui-view/div[2]/table[2]/tbody[' + str(k) + ']/tr[1]/td[2]').text
            Affected.append(AffectProduct+' '+AffectOS)
        except:
            break
    # print('Affected :' + str(Affected))
    time.sleep(2)  # Let the user actually see something!
    driver.close()

    df = pd.DataFrame({
        'CveNo': CveNo ,
        'CveName': CveName ,
        'Description': Description ,
        'AttackScenario': AttackScenario ,
        'Affected': Affected ,

    })
    print('CveNo: ' + df['CveNo'].get(0))
    print('CveName: ' + df['CveName'].get(0))
    print('Description: ' + df['Description'].get(0))
    print('AttackScenario: ' + df['AttackScenario'].get(0))
    print('Affected: ' + df['Affected'].get(0))
    for i in range(0, len(df['Affected'])):
        print('Affected' + str(i+1) + ': ' + df['Affected'].get(i))

# CVE-2019-0708  CVE-2020-0970 CVE-2020-1232
get_microsoft_cve('CVE-2019-0708')
